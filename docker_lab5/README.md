# Отчет по Практической работе №5: Контейнеризация приложений с использованием Docker

## Цель работы
Научиться настраивать мониторинг контейнерных приложений, собирать метрики, визуализировать данные в Grafana и выполнять горизонтальное масштабирование сервисов с помощью Docker Compose.

## Выполненные задачи

### 1. Подготовка приложения (Flask)
- Создано простое Flask-приложение.
- Добавлена библиотека `prometheus-client`.
- Реализован endpoint `/metrics` для экспорта внутренних метрик (счетчик запросов `app_requests_total`).
- Приложение возвращает `Hostname` контейнера для проверки балансировки.

### 2. Настройка мониторинга
- **Prometheus**: Настроен сбор метрик (scraping) с сервисов `web` (наше приложение) и `cadvisor` каждые 5 секунд.
- **cAdvisor**: Развернут для сбора метрик использования ресурсов контейнеров (CPU, RAM, сеть).
- **Grafana**: Развернута для визуализации данных из Prometheus.

### 3. Балансировка нагрузки
- Настроен **Nginx** в качестве Reverse Proxy.
- Конфигурация `upstream` указывает на сервис `web:5000`.
- Nginx распределяет входящие запросы между экземплярами приложения.

### 4. Оркестрация (Docker Compose)
Создан файл `docker-compose.yml`, описывающий 5 сервисов:
- `web`: Приложение (масштабируемое).
- `nginx`: Балансировщик нагрузки.
- `prometheus`: Сбор метрик.
- `grafana`: Визуализация.
- `cadvisor`: Мониторинг ресурсов Docker.

## Инструкция по запуску

1. **Запуск сервисов:**
   ```bash
   docker compose up -d
   ```

2. **Масштабирование веб-сервиса (до 3-х реплик):**
   ```bash
   docker compose up --scale web=3 -d
   ```

3. **Перезапуск Nginx (для обновления списка апстримов):**
   ```bash
   docker compose restart nginx
   ```

4. **Проверка статуса:**
   ```bash
   docker compose ps
   ```

## Результаты проверки

### Проверка балансировки (curl)
Выполнены запросы к `http://localhost`. Ответы приходят от разных контейнеров, что подтверждает работу балансировки (Round Robin):

```text
Hello from container: 2215e8d38d93
Hello from container: af429d8123a1
Hello from container: 7b912c9812d4
```

### Мониторинг
- **Prometheus** доступен по адресу: `http://localhost:9090`
- **Grafana** доступна по адресу: `http://localhost:3000`
- Метрики успешно собираются и могут быть визуализированы на дашбордах Grafana (пример метрики: `app_requests_total`).

## Структура проекта
```
.
├── app/
│   ├── app.py           # Исходный код Flask + Prometheus exporter
│   ├── Dockerfile       # Сборка образа приложения
│   └── requirements.txt # Зависимости
├── monitoring/
│   └── prometheus.yml   # Конфиг Prometheus (target web & cadvisor)
├── docker-compose.yml   # Описание инфраструктуры
├── nginx.conf           # Конфиг балансировщика
└── README.md            # Отчет
```

## Вывод
В ходе работы была успешно развернута микросервисная архитектура с возможностью горизонтального масштабирования. Настроен полный цикл observability: от экспорта метрик из кода до их сбора в Prometheus и визуализации. Реализована балансировка нагрузки через Nginx.